<!DOCTYPE html>
<html>

<!-- *********************** HEAD *********************** -->
<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #e0ffff; /*#f5f5f5;*/
}

.output {
  background-color: #ffffe6; 
}

.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}

/* Font of variable names*/
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="author" content="Prof. Dr. Johannes Binswanger" />
 
<title>Programming for Practical Data Analysis</title>

<!-- ******* LIBRARIES AND PLUGINS ******* -->

<!-- my own css file -->
<link rel="stylesheet" href="css/baseline.css" type="text/css" />

<!-- jquery, nestedToc, slidesjs ... -->
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript">//call jquery library</script>

<script src="js/jquery-nestedToc.js">// get nestedToc from http://www.jqueryscript.net/menu/Dynamic-Table-of-Contents-Generator-With-jQuery-nestedToc.html
</script>

<script src="js/jquery.slides.min.js"></script>


</head>

<!-- *********************** END OF HEAD *********************** -->

<body>
<!-- ************************************** -->
<!-- AUTOMATIC INSERTION OF "BACK TO TOP"-->
<script>
// Select all headers to prepend "back to top" link.
// However, exclude the first heading, and the author and date
// Do so by creating a class noBackToTop. It is possible to assign multiple classes to an element.
// See http://stackoverflow.com/questions/3015103/jquery-exclude-elements-with-certain-class-in-selector

//NOTE: It is very important to use .before and not .prepend below!!!
// If you use prepend, the TOC gets screwed as the text shows up there as well!!

$(document).ready(function(){
	// Automatic "back to top" before a new heading, but not when the heading is of class noBackToTop, because 
	// there is immediately a subheading
    $(":header:not('.noBackToTop')").before("<p><a href='#docHeader'; style = 'font-size:1em; color: #A0A0A0'>[Back to top]</a></p>");
	// The back to top at the end of the document
	 $(".scriptText").append("<p><a href='#docHeader' style = 'font-size:1em; color: #A0A0A0'>[Back to top]</a></p>");
	 
	 //Horizontal ruler
	 $("h1:not('.noBackToTop')").before("<div class='markEnd'> </div>");
	 
	 
	
});


</script>



<!-- ************************************** 
     **************************************
	 **************************************
	 
-->








<div id="content">

<!-- *********************** TITLE ITEMS *********************** -->

<div id="docHeader">
    <p class="title">Programming for Practical Data Analysis</p>
    <h4 class="author noBackToTop"><em>Johannes Binswanger, University of St. Gallen</em></h4>
    <h4 class="date noBackToTop"><em>Spring 2016</em></h4>
</div> <!-- end of docHeader div -->



<!-- *********************** TABLE OF CONTENT (TOC) *********************** -->

<!-- This contains a toggle button 
and the table of content -->

<div class="tocContainer">
     
<script>
//jQuery code for toggle button
$( document ).ready( function( ) {
$( ".TOCbutton" ).click(function() {
  $( ".tocToggleContainer" ).toggle();
});
});
</script>

<!-- the button -->
<button class="TOCbutton" style="color: #27738C;font-size: 20px;">Show/hide table of content</button>




</div>

<div class="tocToggleContainer">
<!-- This div is empty, for the toggle -->
</div>

<!-- The following div below has the same class as the previous!! And do not forget to add the particular styling about display. Note that the second div contains another div that contains the toc. This is to keep both the toc and the toggle work. It may not be necessary with the particular toc solution chosen here, but it is necessary for other toc solutions.
-->
    <div class="tocToggleContainer" style="display: none">
    <div class = "toc">
        <script>
        // This script is simply copied from 
        // http://www.jqueryscript.net/menu/Dynamic-Table-of-Contents-Generator-With-jQuery-nestedToc.html
        $( document ).ready( function( ) {
        $('.toc').nestedToc({
    
        container: '.scriptText'
    
      });
      });
      </script>
</div>
</div>





<!-- Button for download as pdf -->
<!-- Do NOT use something like 

<button class = "downloadPDF"><a href="test.pdf" style="color: #27738C; text-decoration:none;">Get this page as PDF</a></button>

Although it works in Chrome, Android, Edge, it doesn't in Firexox an IE. The problem is the anchor tags inside the button. With only the anchor tags not inside the button, everything works well. 

There is a solution that works for all browsers, luckily: JavaScript, as specified below.

-->

<!-- *********************** Download as pdf DISABLED  *********************** 


<button class="downloadPDF" onclick = "window.open('pdfs/script_as_pdf.pdf')" style="color: #27738C;">
Get this page as PDF</button>

-->


<!-- ************************************************************************* -->


<!-- *********************** MAIN DOCUMENT STARTS HERE *********************** -->



<!-- ************************************************************************* -->



<div class = "scriptText"> <!-- This div contains the main text -->








<!-- *********************** INTRODUCTION *********************** -->
<h1 id="introduction" class="noBackToTop" style = "padding-top: 20px;">Introduction</h1>


<p>In a world full of cars, driving is a useful skill. Indeed, many people know how to drive. In a world full of data - such as our modern world - programming skills for data analysis are highly useful. However, many people do <em>not</em> know how to program, including many economics students &hellip; Why is data analysis so important in today's world? This is because the modern world is so rich with data, and because data underlie important decisions made in governments, firms, NGOs and elsewhere. Or, at least, that's how it should be &hellip;</p>

<p>In this course, you will learn essential elements of programming that allow you to analyze and visualize data, as well as communicate your results such that they can be distributed to decision making teams in ministries and boardrooms. So, importantly, this course is not "just" about programming. It's about the whole process of data-based decision making. This includes the collection of data, data analysis, data visualization, and communication.
</p>


<p>Now, "programming" is a sort of awe-inspiring word. What does it actually mean? During this course you will learn to understand that programming is <em>not</em> so much about making complicated calculations and statistical analysis. And it's not just about coding. What programming really is about is the <b>automation of tasks</b>. More poetically, programming is about finding universal solution procedures to problems by making use of algorithms. That sounds awesome but also pretty abstract. Keep it in mind and during the course you will learn to understand what this means.</p>

<p>In this course we will make use of the programming environment of the <em>R language</em>. R has become extremely popular as a tool for data analysis in recent years (see <a href="http://r4stats.com/articles/popularity/" target = "_blank">article</a> on r4stats). R is much more popular among programmers than commercial software, with the exception of SAS and SPSS (the latter only among academics). However, SPSS offers generally less functionality. Other popular programming languages are Python and Java. Python is also quite easy to learn, however, it is somewhat cumbersome to get it running on Windows machines. As for Java, it takes considerably more time before you can do anything sophisticated. As you can see in the mentioned article, R is clearly more popular than Stata or Matlab when it comes to job requirements (in the analytics business). It is also more popular among academics, but only marginally so. However, I figured that most of you do not necessarily want to become academics, and so, all in all, R seemed the best-suited programming language for this course.</p>

<p>But why not just having an advanced course in Excel? Well, excel is not really a useful analytics tool since it is not made for programming. This means that you forgo many options to <em>automate</em> your analysis. Automation means that you write your code only once, and whenever your boss wants to see a new analysis, you change a parameter, hit a button, and within a minute you have a beautiful new report. In Excel, you would possibly be clicking around for several hours, and you would most likely make mistakes on that way. In other words, you would feel pretty miserable. You will get to understand better what I mean during this course. As a side-note, it is possible to program with Excel. However, this would require to learn the Visual Basic programming language. It seems much more practical to directly learn R, instead!</p>


<p></p>
<p></p>



<!-- *************************************************************************************** -->



<h1 id="organization-of-this-course">Organization of this course</h1>


<h2 id="structure-of-this-course" class="noBackToTop">Structure of the course</h2>

<p>This course features <a href = "https://www1.unisg.ch/org/st-ppp/vprgso16.nsf/(vwLStudienplanByNumber)/6,246,1.00?OpenDocument" target = "_blank/"> 11 units</a>. The course is structured as follows:
	<ol> <li> Introduction into the most important elements of R and data analysis; on the playground using fake data; 2 sessions
		<li> Applying programming with R "in the wild"; we will analyze data published by the Swiss National Bank; 6 sessions
		<li> Do-it-yourself group-projects and in-class presentations; 2 sessions
		<li> Graded assignment in the last session
	</ol>

</p>

<h2 id="group-projects">Home-assignments</h2>

<p>Doing things yourself, spending time on figuring out what happens if you change this or that piece of code is absolutely essential for learning to program. Therefore, you will regularly be asked to solve some programming problems at home. Often, the home assignments involve some heavy googling.</p>

<p style = "padding-left:40px; padding-right: 70px"><span style = "color:#e60000;">NOTE: At the beginning of the class, some of you may sometimes be asked on a random basis to present your solution or &mdash; if you were not able to solve it &mdash; comment on your experience and why you run into troubles. 
</span></p>

<p style = "padding-left:40px; padding-right: 70px"><span style = "color:#e60000;">I will also regularly ask you one or a few open-ended question using the <em>Test</em> feature on StudyNet. For your answer, you may have to copy a piece of code into the answer field.</span></p>


<h2 id="group-projects">Group projects</h2>

<p>You will be working on a project where you put into practice what you have learned in this course. You will work in <b>groups of 3 students</b>. You are free to propose your own topic and data. You will present your results in short elevator-pitch-like presentations in the sessions on <b>May 12 and May 19. Attendence of these sessions is mandatory.</b> You find more detailed instructions for the group projects on StudyNet under <i>Kursunterlagen</i>.</p>


<h2 id="exam-and-grading">Exams and grading</h2>

<p>The overall grade for this course will depend on both the quality of your group-project and the in-class assignment during the last session. The group assignment counts for 60 percent, the in-class assignment counts for 40 percent of your overall grade. Please find further information in the <a href = "pdfs/Kursmerkblatt.pdf" target="_blank"><em>Kursmerkblatt</em></a>. The in-class assignment will include questions where you have to google for the solution of a problem that you have not yet seen in exactly this form. You will train this during the course and while working on your group project. Furthermore, you will have to understand a piece of code that someone else has written, potentially with a mistake. All thi prepares you for real-life analytics.</p>


<h2 id="lecture-notes-and-books">Lecture notes, books, further readings &hellip;</h2>

<blockquote class="leadingQuote"><q><i>When learning to code, Google is your best friend...</i></q>
<a href = http://stackoverflow.com/questions/14830014/add-image-s-inside-a-div-with-jquery target="_blank">Stackoverflow</a></blockquote>

<p>For this course, you do not have to read any books. The best source for R documentation is the Internet, as the quote above suggests. In fact, books become quickly outdated since R is evolving rapidly. Therefore, you will have to learn to rely on googling. You will also find quite a number of good videos on Youtube. Finding solutions through googling will also be an important learning goal of this course.</p>

<p>Having said this, the most important material for this course, in terms of documentation, are the R and markdown scripts that we will work out together during classes. These scripts will contain many comments that allow you to understand what we are doing. A second important source are these notes you are just reading, in form of a simple website. I have tried my best to make this website somehow readable on any device and for any browser. However, some features do not look optimal for some browsers (sliders look somewhat ugly in Safari, and it is not possible to make the text bigger in Edge). If you encounter troubles, try to use Chrome; if that also does not work, let me know.</p>

<p style = "padding-left:40px; padding-right: 70px"><span style = "color:#e60000;">NOTE: After each class, the R scripts that we worked on during class will be published in these lecture notes, together with any remarks that seem noteworthy in light of the discussions during class.
</span></p>

<p>If you nevertheless feel better having a book in your hands, this one is actually very well written, very accessible, and still mostly up-to-date:
<ul><li>Jared P. Lander, <em>R for Everyone</em>, Addison Wesley Data & Analytics Series, 2014
</ul>
</p>

<h2 id="communication">Communication</h2>

<p>If you feel that a particular topic remained unclear and you want me to get back to it during the following class, or if you have suggestions for covering additional material, feel free to send an email to <span style = "color:#27738C">johannes.binswanger@unisg.ch</span>. I also set up a forum on StudyNet where you can send anonymous feedback. But please be constructive, even if it's anonymous &hellip;</p>









<!-- ************  GETTING STARTED ********************  -->




<h1 id="lecture1">Lecture 1</h1>

<p>During the first session, we did install R and RStudio. Although we had some problems with the WiFi hotspot, it worked for most or you. In this <a href="pdfs/Installing R on Win10.pdf" target = "_blank">pdf</a> you find some quick-and-dirty documentation of the most important screenshots for installing R and RStudio on a Windows 10 machine. Below, you find a simple slide show that shows the installation on a Mac.</p>

  


<!-- ************  IMAGES SLIDE SHOW ********************  -->


<!-- Use Slide.js
http://www.slidesjs.com/
Download and select... I chose the Standard version, see Slides-SlidesJS-3/examples/standard
-->


<div class="slideFrame">
<div class="container">
<p class="slideShowTitle"><i>SLIDESHOW: </i>Here are some screenshots I made when installing R and RStudio on a Mac</p>
    <div id="slides">
    <img src="images/image (1).png" >
    <img src="images/image (2).png" >
      <img src="images/image (3).png" >
	  <img src="images/image (4).png" >
	  <img src="images/image (5).png" >
	  <img src="images/image (6).png" >
	  <img src="images/image (7).png" >
	  <img src="images/image (8).png" >
	  <img src="images/image (9).png" >
	  <img src="images/image (10).png" >
	  <img src="images/image (11).png" >
    <img src="images/image (12).png" >
      <img src="images/image (13).png" >
	  <img src="images/image (14).png" >
	  <img src="images/image (15).png" >
	  <img src="images/image (16).png" >
	  <img src="images/image (17).png" >
	  <img src="images/image (18).png" >
	  <img src="images/image (19).png" >
	  <img src="images/image (20).png" >
	  <img src="images/image (21).png" >
    <img src="images/image (22).png" >
      <img src="images/image (23).png" >
	  <img src="images/image (24).png" >
	  <img src="images/image (25).png" >
	  <img src="images/image (26).png" >
	  <img src="images/image (27).png" >
	  <img src="images/image (28).png" >
	  <img src="images/image (29).png" >
	  <img src="images/image (30).png" >
	  <img src="images/image (31).png" >
    <img src="images/image (32).png" >
      <img src="images/image (33).png" >
	  <img src="images/image (34).png" >
	  <img src="images/image (35).png" >
	  <img src="images/image (36).png" >
	  <img src="images/image (37).png" >
	  
      
      <a href="#" class="slidesjs-previous slidesjs-navigation"><i class="icon-chevron-left icon-large"></i></a>
      <a href="#" class="slidesjs-next slidesjs-navigation"><i class="icon-chevron-right icon-large"></i></a>
    </div>
  </div>
 </div>
  
  

  <script>
    $(function() {
      $('#slides').slidesjs({
        width: 800,
        height: 520,//USE THIS LINE TO REGULATE DISTANCE BETWEEN PREVIOUS/NEXT AND IMAGE!!!
        navigation: {active: true}
      });
    });
	
	
	
  </script>
  
  

  



<!-- ************ END OF IMAGES SLIDE SHOW ********************  -->

</br>  

</br>  

<p>During class, we worked out the following script (note that below you can also see the results of our commands, indicated by double hashtags).</p>


<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># R live script, Lecture 1, Feb 25, 2016</span>

<span class="hl std">a</span> <span class="hl kwb">=</span> <span class="hl num">2</span>
<span class="hl std">a</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 2
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Variables have types. Let's see what's</span>
<span class="hl com"># the type of a...</span>
<span class="hl kwd">class</span><span class="hl std">(a)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;numeric&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Are there other types?</span>
<span class="hl std">aAsChar</span> <span class="hl kwb">=</span> <span class="hl str">&quot;a&quot;</span>
<span class="hl std">aAsChar</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;a&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">class</span><span class="hl std">(aAsChar)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;character&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#Go on...</span>
<span class="hl std">b</span> <span class="hl kwb">=</span> <span class="hl num">3</span>
<span class="hl std">bAsWhatever</span> <span class="hl kwb">=</span> <span class="hl std">b</span>
<span class="hl std">bAsWhatever</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 3
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Let's do some algebra</span>
<span class="hl std">a</span><span class="hl opt">+</span><span class="hl std">b</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 5
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">a</span><span class="hl opt">*</span><span class="hl std">b</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 6
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">a</span><span class="hl opt">^</span><span class="hl std">b</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 8
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">i</span> <span class="hl kwb">&lt;-</span> <span class="hl num">1</span>  <span class="hl com"># Assignment operator</span>
        <span class="hl com"># same as &quot;=&quot;, the latter is also assignment operator</span>
<span class="hl std">i</span> <span class="hl kwb">=</span> <span class="hl num">1</span>
<span class="hl std">j</span> <span class="hl kwb">=</span> <span class="hl std">i</span>  <span class="hl com"># passed by value</span>
<span class="hl std">i</span> <span class="hl kwb">=</span> <span class="hl num">2</span>
<span class="hl com"># What will j be?</span>
<span class="hl std">j</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 1
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">i</span> <span class="hl opt">==</span> <span class="hl std">j</span> <span class="hl com"># this is nothing else as 2 == 1</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] FALSE
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># &quot;=&quot; is an assignment operator</span>
<span class="hl com"># &quot;==&quot; means mathematical equality</span>

<span class="hl std">l</span> <span class="hl kwb">=</span> <span class="hl std">i</span> <span class="hl opt">==</span><span class="hl std">j</span>
<span class="hl std">l</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] FALSE
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">class</span><span class="hl std">(l)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;logical&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">######################################################</span>
<span class="hl com">######################################################</span>

<span class="hl com"># Beyond the most basic data structures</span>
<span class="hl std">shopList</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;milk (l)&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;cereals (packs)&quot;</span><span class="hl std">,</span>
             <span class="hl str">&quot;quollfrisch (packs)&quot;</span><span class="hl std">)</span>

<span class="hl com"># shopList is a vector</span>

<span class="hl std">quantList</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">,</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl num">5</span><span class="hl std">)</span>

<span class="hl std">priceList</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1.95</span><span class="hl std">,</span> <span class="hl num">2.05</span><span class="hl std">,</span> <span class="hl num">11.95</span><span class="hl std">)</span>

<span class="hl std">shoppingData</span> <span class="hl kwb">=</span> <span class="hl kwd">data.frame</span><span class="hl std">(shopList, quantList, priceList)</span>

<span class="hl kwd">class</span><span class="hl std">(shoppingData)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;data.frame&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">shoppingData</span><span class="hl opt">$</span><span class="hl std">expPerItem</span> <span class="hl kwb">=</span>
  <span class="hl std">shoppingData</span><span class="hl opt">$</span><span class="hl std">quantList</span><span class="hl opt">*</span><span class="hl std">shoppingData</span><span class="hl opt">$</span><span class="hl std">priceList</span>

<span class="hl kwd">sink</span><span class="hl std">(</span><span class="hl str">&quot;myShopList.txt&quot;</span><span class="hl std">,</span> <span class="hl kwc">append</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl std">shoppingData</span>
</pre></div>
<div class="output"><pre class="knitr r">##              shopList quantList priceList expPerItem
## 1            milk (l)         3      1.95       5.85
## 2     cereals (packs)         2      2.05       4.10
## 3 quollfrisch (packs)         5     11.95      59.75
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sink</span><span class="hl std">()</span>
<span class="hl kwd">file.show</span><span class="hl std">(</span><span class="hl str">&quot;myShopList.txt&quot;</span><span class="hl std">)</span>
</pre></div>
</div></div>

<p>To sum up, you have learned to following during this lecture:
<ul>
  <li>There are a number of different data types:
  <ul>
    <li>numeric types
    <li>character types
    <li>logical types
    <li>data frames (i.e. a sort of spreadsheet)
  </ul>
  <li> &quot;=&quot; or &quot;<-&quot; means assignment
  <li> &quot;= =&quot; means mathematical equality
</ul>
</p>

<p>Next time, we'll dig a little deeper.</p>


<!-- ************************************************************** -->


<h1 id="lecture2">Lecture 2</h1>

<p>During class, we worked on the following lines of code.</p>

<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">#################</span>
<span class="hl com"># Lecture 2 live</span>
<span class="hl com">#################</span>

<span class="hl com"># Topics of this lecture</span>
<span class="hl com"># 1) Juggling with dataframes</span>
<span class="hl com"># 2) Reading data from a website</span>
<span class="hl com"># 3) Package</span>
<span class="hl com"># 4) Loops</span>
<span class="hl com"># 5) Drawing random numbers from a particular</span>
<span class="hl com">#   distribution (if we get there)</span>

<span class="hl com"># Install XML package</span>
<span class="hl com"># Do this only once per machine!</span>
<span class="hl com"># It's like an app</span>
<span class="hl com"># install.packages(&quot;XML&quot;)</span>

<span class="hl com"># Call the package/library</span>
<span class="hl com"># Do this in every session</span>
<span class="hl kwd">rm</span><span class="hl std">(</span><span class="hl kwc">list</span> <span class="hl std">=</span> <span class="hl kwd">ls</span><span class="hl std">())</span>
<span class="hl kwd">library</span><span class="hl std">(</span><span class="hl str">&quot;XML&quot;</span><span class="hl std">)</span>

<span class="hl std">shopList_0</span> <span class="hl kwb">=</span> <span class="hl kwd">readHTMLTable</span><span class="hl std">(</span><span class="hl str">&quot;http://www.einkaufszettel.de/einkaufslisten/einkaufszettel-vorlage&quot;</span><span class="hl std">)</span>
<span class="hl kwd">class</span><span class="hl std">(shopList_0)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;list&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># This is a list, new data type</span>
<span class="hl kwd">length</span><span class="hl std">(shopList_0)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 2
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Select second list item</span>
<span class="hl std">shopList</span> <span class="hl kwb">=</span> <span class="hl std">shopList_0[[</span><span class="hl num">2</span><span class="hl std">]]</span>
<span class="hl kwd">class</span><span class="hl std">(shopList)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;data.frame&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">class</span><span class="hl std">(shopList</span><span class="hl opt">$</span><span class="hl std">V1)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;factor&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># The type of this variable is factor</span>
<span class="hl com"># and we don't like that, for what we want to do</span>
<span class="hl com"># We want &quot;character&quot;</span>
<span class="hl std">shopList[]</span> <span class="hl kwb">=</span> <span class="hl kwd">lapply</span><span class="hl std">(shopList, as.character)</span>
<span class="hl kwd">class</span><span class="hl std">(shopList</span><span class="hl opt">$</span><span class="hl std">V1)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;character&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">test1</span> <span class="hl kwb">=</span> <span class="hl std">shopList[</span>   <span class="hl num">1</span> <span class="hl std">,</span> <span class="hl com">#rows </span>
                      <span class="hl std">]</span> <span class="hl com">#columns</span>
                        <span class="hl com"># empty means ALL!</span>
<span class="hl std">test1</span> <span class="hl kwb">=</span> <span class="hl std">shopList[</span><span class="hl num">1</span><span class="hl std">, ]</span>
<span class="hl kwd">class</span><span class="hl std">(test1)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;data.frame&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">test2</span> <span class="hl kwb">=</span> <span class="hl std">shopList[ ,</span> <span class="hl num">1</span><span class="hl std">]</span>
<span class="hl kwd">class</span><span class="hl std">(test2)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;character&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">test3</span> <span class="hl kwb">=</span> <span class="hl std">shopList[ ,</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">2</span><span class="hl std">)]</span>

<span class="hl com"># delete row 1 and 18 from shopList</span>
<span class="hl std">shopList</span> <span class="hl kwb">=</span> <span class="hl std">shopList[</span> <span class="hl opt">-</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">18</span><span class="hl std">) ,  ]</span>

<span class="hl com">#columns to select</span>
<span class="hl std">sel</span> <span class="hl kwb">=</span> <span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">9</span><span class="hl std">,</span> <span class="hl kwc">by</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">)</span>

<span class="hl std">shopList</span> <span class="hl kwb">=</span> <span class="hl std">shopList[ , sel]</span>

<span class="hl kwd">rm</span><span class="hl std">(</span><span class="hl kwc">list</span> <span class="hl std">=</span> <span class="hl kwd">ls</span><span class="hl std">(</span><span class="hl kwc">pattern</span> <span class="hl std">=</span> <span class="hl str">&quot;^test&quot;</span><span class="hl std">))</span>

<span class="hl com"># Tests for getting all shopping items in one column</span>
<span class="hl std">test1</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(shopList</span><span class="hl opt">$</span><span class="hl std">V1,</span>
          <span class="hl std">shopList</span><span class="hl opt">$</span><span class="hl std">V3,</span>
          <span class="hl std">shopList</span><span class="hl opt">$</span><span class="hl std">V5,</span>
          <span class="hl std">shopList</span><span class="hl opt">$</span><span class="hl std">V7,</span>
          <span class="hl std">shopList</span><span class="hl opt">$</span><span class="hl std">V9</span>
          <span class="hl std">)</span>

<span class="hl std">test1</span> <span class="hl kwb">=</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(test1)</span>

<span class="hl std">test2</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">()</span> <span class="hl com">#initialization</span>
<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(shopList)){</span>
  <span class="hl com"># Here is our algorithm</span>
  <span class="hl std">test2</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(test2, shopList[ , i])</span>
<span class="hl std">}</span>
<span class="hl std">test2</span> <span class="hl kwb">=</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(test2)</span>

<span class="hl std">shopList</span> <span class="hl kwb">=</span> <span class="hl std">test2</span>
<span class="hl kwd">class</span><span class="hl std">(shopList)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;data.frame&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Change name of the single variable in shopList</span>
<span class="hl kwd">names</span><span class="hl std">(shopList)</span> <span class="hl kwb">=</span> <span class="hl str">&quot;item&quot;</span>
<span class="hl kwd">class</span><span class="hl std">(shopList</span><span class="hl opt">$</span><span class="hl std">item)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;factor&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#Convert this to character</span>
<span class="hl std">shopList[]</span> <span class="hl kwb">=</span> <span class="hl kwd">lapply</span><span class="hl std">(shopList, as.character)</span>
<span class="hl kwd">class</span><span class="hl std">(shopList</span><span class="hl opt">$</span><span class="hl std">item)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;character&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sink</span><span class="hl std">(</span><span class="hl str">&quot;inspectWhatWeAreDoing.txt&quot;</span><span class="hl std">,</span> <span class="hl kwc">append</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl std">shopList</span><span class="hl opt">$</span><span class="hl std">item</span> <span class="hl opt">==</span> <span class="hl str">&quot;&quot;</span>
</pre></div>
<div class="output"><pre class="knitr r">##   [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [12]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
##  [23] FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [34]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
##  [45] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE
##  [56] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [67] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE FALSE
##  [78] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [89] FALSE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [100] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE
## [111]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [122] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE FALSE FALSE
## [133] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [144] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE
## [155] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
## [166]  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [177] FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [188]  TRUE  TRUE  TRUE
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">which</span><span class="hl std">(shopList</span><span class="hl opt">$</span><span class="hl std">item</span> <span class="hl opt">==</span> <span class="hl str">&quot;&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">##  [1]  12  13  14  15  16  27  28  29  30  31  32  33  34  35  36  37  38
## [18]  50  51  52  53  54  74  75  76  90  91  92 106 107 108 109 110 111
## [35] 112 113 114 128 129 130 149 150 151 152 162 163 164 165 166 167 168
## [52] 179 182 183 184 185 186 187 188 189 190
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sink</span><span class="hl std">()</span>
<span class="hl kwd">file.show</span><span class="hl std">(</span><span class="hl str">&quot;inspectWhatWeAreDoing.txt&quot;</span><span class="hl std">)</span>

<span class="hl com"># In class, we got until here. </span>

<span class="hl com"># Now we still want to drop the empty rows from shopList</span>
<span class="hl com"># In class, I still typed the following (how commented out with hashtags)</span>

<span class="hl com"># shopList = shopList[-which(shopList$item == &quot;&quot;) , ]</span>

<span class="hl com"># This does not yield the desired result, for somewhat complicated reasons</span>
<span class="hl com"># Let's not bother right now. </span>
<span class="hl com"># Instead, the following works</span>

<span class="hl std">shopList</span> <span class="hl kwb">=</span> <span class="hl kwd">as.data.frame</span><span class="hl std">(shopList</span><span class="hl opt">$</span><span class="hl std">item[</span><span class="hl opt">-</span><span class="hl kwd">which</span><span class="hl std">(shopList</span><span class="hl opt">$</span><span class="hl std">item</span> <span class="hl opt">==</span> <span class="hl str">&quot;&quot;</span><span class="hl std">) ])</span>
<span class="hl kwd">names</span><span class="hl std">(shopList)</span> <span class="hl kwb">=</span> <span class="hl str">&quot;item&quot;</span>
</pre></div>
</div></div>

<p>During class, the very last command did not achieve what we wanted, namely deleting
all empty rows for the <code>item</code> column of the dataframe. In the above script, I added two lines that actually achieve what we want. (The reason why the piece we typed in class does not work is a bit complicated, let's not bother&hellip;) </p>

<p>The most important things you have seen during this lecture are the following.
<ul>
  <li> Install a package with <code>install.packages(&lt;package name in quotes&gt;)</code>. You have to do this only once on a particular machine.
  <li> Load packages with <code>library(&lt;package name in quotes&gt;)</code>.
  <li> There is a data type <code>list</code>.
  <li> There is a data type <code>factor</code>.
  <li> You can select rows and columns from a data frame with <code>dataframe[&lt;rows&gt;,&lt;columns&gt;]</code>.
  <li> You can select multiple rows or columns, and you can <i>un</i>select columns by using a minus sign.
  <li>Use loops for &rdquo;repetitive&ldquo; tasks.
  <li>Give names to columns/variables with <code>names(dataframe)</code>.
  <li>And a few more things&hellip;
</ul>
</p>

<h1 id="lecture3">Lecture 3</h1>

<p>In this lecture, we first touched real data, downloaded them from the <a href = "https://data.snb.ch/de/topics" target = "_blank">data portal</a> of the Swiss national bank.</p>

<p>As we found out (at least some of you), downloading data in <code>csv</code> format can be tricky. Well, not the actual download, but you can get nasty surprises when discovering that the data appear in a pretty &rdquo;ugly&ldquo; format. See this <a href="pdfs/MessyCSV_screens.pdf" target = "_blank"> link</a> for some screenshots together with hints about how to proceed.</p>

<p>In sum, you have the following options when you get an &rdquo;ugly&ldquo; csv file. One or the other may work, hopefully&hellip;
<ul>
	<li>Change the regional settings of your machine to match the region of the data platform (in case of the OECD use English &ndash; United States).
	<li>Open Excel and import the &rdquo;ugly&ldquo; file from the <code>Data</code> tab, using <code>Get external data / from text</code>. Play around with the options in the import wizard. Quite often, the solution is to use <code>semicolon</code> as the delimiter, and potentially add <code>other</code>, and insert double quotes (&rdquo;) into the field next to other. This may lead to many empty columns, but it is easy to delete them after reading the data into R.
	<li>Open the &rdquo;ugly&ldquo; file with Notepad (Windows) or TextEdit (Mac). Inspect visually what's wrong and adjust the delimiter in the Excel import wizard accordingly (see previous point).
	<li>Read the &rdquo;ugly&ldquo; data into R using the <code>read.table(&hellip;)</code> command. Then use the string functions of the <code>stringr</code> package. This is a bit more advanced, we have not talked about this. But if you need it, Google and Youtube will get you there!
</ul>
</p>

<p>Note that we did not run any code in Lecture 3. We spent the time understanding and inspecting the inner life of csv files.</p>

<!-- ################################################# -->

<h1 id="lecture4">Lecture 4</h1>

<p>In Lecture 4, we did the following:</p>

<p><ul>
<li>Delete all empty columns in a data frame with a loop; within the loop, we used conditional <code>if</code> statements.
<li>Getting all values in a particular column of a data frame.
<li>Making a simple annotated &rdquo;codebook&ldquo;; this is particularly useful for larger data sets.
<li> Changing particular values in a column of a data frame.
<li> Renaming columns/variables in a data frame.
</ul></p>

<p>Below you find the script we worked on during class. I added a few comments and run it on a Windows machine. Please note that we did not run the last few lines in class (they are clearly marked below, after the line with exclamation marks). Please copy them into your script and make sure they run before next class.</p>


<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">################## </span>
<span class="hl com"># Lecture 4 LIVE #</span>
<span class="hl com">##################</span>

<span class="hl com"># Empty working directory</span>
<span class="hl com"># Good idea to alsways do this at the beginning of a script</span>

<span class="hl kwd">rm</span><span class="hl std">(</span><span class="hl kwc">list</span> <span class="hl std">=</span> <span class="hl kwd">ls</span><span class="hl std">())</span>


<span class="hl com"># Set working directory</span>
<span class="hl com"># I did this in Windows, so note the double backslashes</span>
<span class="hl kwd">setwd</span><span class="hl std">(</span><span class="hl str">&quot;D:\\Dropbox\\Mac&amp;Surf\\KursLiveDropb&quot;</span><span class="hl std">)</span>

<span class="hl std">aussen</span> <span class="hl kwb">=</span> <span class="hl kwd">read.table</span><span class="hl std">(</span><span class="hl str">&quot;aussenSNB_clean.csv&quot;</span><span class="hl std">,</span> <span class="hl kwc">header</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">,</span>
           <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span>
           <span class="hl kwc">stringsAsFactors</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>

<span class="hl com"># We want to delete the empty columns with a loop...</span>
<span class="hl com"># First the pieces we need in isolation</span>

<span class="hl std">aussen[[</span><span class="hl num">2</span><span class="hl std">]]</span> <span class="hl com"># second column</span>
</pre></div>
<div class="output"><pre class="knitr r">##    [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##   [24] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##   [47] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##   [70] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##   [93] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [116] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [139] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [162] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [185] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [208] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [231] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [254] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [277] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [300] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [323] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [346] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [369] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [392] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [415] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [438] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [461] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [484] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [507] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [530] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [553] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [576] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [599] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [622] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [645] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [668] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [691] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [714] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [737] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [760] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [783] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [806] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [829] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [852] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [875] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [898] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [921] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [944] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [967] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
##  [990] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1013] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1036] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1059] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1082] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1105] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1128] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1151] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1174] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1197] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1220] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1243] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1266] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [1289] NA NA NA NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">all</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(aussen[[</span><span class="hl num">2</span><span class="hl std">]]))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] TRUE
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># conditional</span>
<span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl kwd">all</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(aussen[[</span><span class="hl num">2</span><span class="hl std">]]))</span> <span class="hl opt">==</span> <span class="hl num">TRUE</span><span class="hl std">) {</span>
  <span class="hl std">test</span> <span class="hl kwb">=</span> <span class="hl str">&quot;delete me!&quot;</span>
<span class="hl std">}</span>
<span class="hl std">test</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;delete me!&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># And now the full loop that collects the numbers of </span>
<span class="hl com"># the columns to be deleted</span>
<span class="hl std">toDelete</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">()</span>
<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(aussen)){</span>
      <span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl kwd">all</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(aussen[[i]]))</span> <span class="hl opt">==</span> <span class="hl num">TRUE</span><span class="hl std">) {</span>
            <span class="hl std">toDelete</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(toDelete, i)</span>
      <span class="hl std">}</span>
<span class="hl std">}</span>
<span class="hl std">toDelete</span>
</pre></div>
<div class="output"><pre class="knitr r">##  [1]  2  3  5  6  7  8 10 11 12 13 15 16 17 18
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># If you have no empty columns, then the value of </span>
<span class="hl com"># toDelete is NULL</span>

<span class="hl com"># Check it out</span>
<span class="hl kwd">is.null</span><span class="hl std">(toDelete)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] FALSE
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># If toDelete is NOT null, then delete the empty columns.</span>
<span class="hl com"># Otherwise, do nothing</span>
<span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl kwd">is.null</span><span class="hl std">(toDelete)</span><span class="hl opt">==</span><span class="hl num">FALSE</span><span class="hl std">){</span>
<span class="hl std">aussen</span> <span class="hl kwb">=</span> <span class="hl std">aussen[ ,</span> <span class="hl opt">-</span><span class="hl std">toDelete]</span>
<span class="hl std">}</span>

<span class="hl com">#############################</span>
<span class="hl com"># Read exchange rates</span>

<span class="hl com"># Exactly the same steps as above</span>

<span class="hl std">devisen</span> <span class="hl kwb">=</span> <span class="hl kwd">read.table</span><span class="hl std">(</span><span class="hl str">&quot;devisenSNB_clean.csv&quot;</span><span class="hl std">,</span> <span class="hl kwc">header</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">,</span>
                    <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;,&quot;</span><span class="hl std">,</span>
                    <span class="hl kwc">stringsAsFactors</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>

<span class="hl std">toDelete</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">()</span>
<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">ncol</span><span class="hl std">(devisen)){</span>
  <span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl kwd">all</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(devisen[[i]]))</span> <span class="hl opt">==</span> <span class="hl num">TRUE</span><span class="hl std">) {</span>
    <span class="hl std">toDelete</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(toDelete, i)</span>
  <span class="hl std">}</span>
<span class="hl std">}</span>
<span class="hl std">toDelete</span>
</pre></div>
<div class="output"><pre class="knitr r">##  [1]  2  3  5  6  7  8 10 11 12 13
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl kwd">is.null</span><span class="hl std">(toDelete)</span><span class="hl opt">==</span><span class="hl num">FALSE</span><span class="hl std">){</span>
  <span class="hl std">devisen</span> <span class="hl kwb">=</span> <span class="hl std">devisen[ ,</span> <span class="hl opt">-</span><span class="hl std">toDelete]</span>
<span class="hl std">}</span>

<span class="hl com">########################</span>

<span class="hl com"># Inspect aussen</span>
<span class="hl com"># Make a sort of &quot;codebook&quot; (often a very useful thing)</span>
<span class="hl com"># Here it's just a mini version. It's all the more useful if the </span>
<span class="hl com"># variables have dozens of values</span>

<span class="hl kwd">sink</span><span class="hl std">(</span><span class="hl str">&quot;inspectAussen.txt&quot;</span><span class="hl std">,</span> <span class="hl kwc">append</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>

    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;\nThe variables D0 contains\n\n&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## The variables D0 contains
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">unique</span><span class="hl std">(aussen</span><span class="hl opt">$</span><span class="hl std">D0)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;E&quot; &quot;A&quot; &quot;H&quot;
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;\n\nThe variables D1 contains\n\n&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## 
## The variables D1 contains
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">unique</span><span class="hl std">(aussen</span><span class="hl opt">$</span><span class="hl std">D1)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;RH&quot; &quot;E&quot;  &quot;I&quot;  &quot;K&quot;  &quot;T&quot;
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl str">&quot;\n\nThe variables D2 contains\n\n&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
## 
## The variables D2 contains
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">unique</span><span class="hl std">(aussen</span><span class="hl opt">$</span><span class="hl std">D2)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;WMF&quot; &quot;R&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sink</span><span class="hl std">()</span>
<span class="hl kwd">file.show</span><span class="hl std">(</span><span class="hl str">&quot;inspectAussen.txt&quot;</span><span class="hl std">)</span>

<span class="hl com"># Get better variable/label names</span>
<span class="hl com"># Note, I am a bit sloppy with the word &quot;variable&quot;.</span>
<span class="hl com"># Here, I mean entry in particular columns. They will</span>
<span class="hl com"># ultimately become &quot;variable names&quot; in the sense of statistics</span>
<span class="hl com"># (or Stata) in one or two weeks...</span>

<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D0[aussen</span><span class="hl opt">$</span><span class="hl std">D0</span> <span class="hl opt">==</span> <span class="hl str">&quot;E&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Einfuhr&quot;</span>
<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D0[aussen</span><span class="hl opt">$</span><span class="hl std">D0</span> <span class="hl opt">==</span> <span class="hl str">&quot;A&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Ausfuhr&quot;</span>
<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D0[aussen</span><span class="hl opt">$</span><span class="hl std">D0</span> <span class="hl opt">==</span> <span class="hl str">&quot;H&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Handelsbilanzsaldo&quot;</span>

<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D1[aussen</span><span class="hl opt">$</span><span class="hl std">D1</span> <span class="hl opt">==</span> <span class="hl str">&quot;RH&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Rohstoffe und Halbfabrikate&quot;</span>
<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D1[aussen</span><span class="hl opt">$</span><span class="hl std">D1</span> <span class="hl opt">==</span> <span class="hl str">&quot;E&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Energietrger&quot;</span>
<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D1[aussen</span><span class="hl opt">$</span><span class="hl std">D1</span> <span class="hl opt">==</span> <span class="hl str">&quot;I&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Investitionsgter&quot;</span>
<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D1[aussen</span><span class="hl opt">$</span><span class="hl std">D1</span> <span class="hl opt">==</span> <span class="hl str">&quot;K&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Konsumgter&quot;</span>
<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D1[aussen</span><span class="hl opt">$</span><span class="hl std">D1</span> <span class="hl opt">==</span> <span class="hl str">&quot;T&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Total&quot;</span>

<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D2[aussen</span><span class="hl opt">$</span><span class="hl std">D2</span> <span class="hl opt">==</span> <span class="hl str">&quot;WMF&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Wert&quot;</span>
<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">D2[aussen</span><span class="hl opt">$</span><span class="hl std">D2</span> <span class="hl opt">==</span> <span class="hl str">&quot;R&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Vernderung real&quot;</span>

<span class="hl com">#Column names</span>
<span class="hl kwd">names</span><span class="hl std">(aussen)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;Date&quot;  &quot;D0&quot;    &quot;D1&quot;    &quot;D2&quot;    &quot;Value&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">names</span><span class="hl std">(aussen)</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;date&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;caItem&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;sector&quot;</span><span class="hl std">,</span>
                <span class="hl str">&quot;measure&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;value&quot;</span><span class="hl std">)</span>

<span class="hl com"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! # </span>

<span class="hl com"># WE DIT **NOT** RUN THE FOLLOWING CODE IN CLASS,</span>
<span class="hl com"># BUT PLEASE DO SO BEFORE NEXT TIME, SUCH THAT WE GAIN</span>
<span class="hl com"># SOME TIME!</span>

<span class="hl kwd">names</span><span class="hl std">(devisen)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;Date&quot;  &quot;D0&quot;    &quot;D1&quot;    &quot;Value&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">unique</span><span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">D1)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;EUR1&quot; &quot;GBP1&quot; &quot;USD1&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">D1[devisen</span><span class="hl opt">$</span><span class="hl std">D1</span> <span class="hl opt">==</span> <span class="hl str">&quot;EUR1&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;Euro per CHF&quot;</span>
<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">D1[devisen</span><span class="hl opt">$</span><span class="hl std">D1</span> <span class="hl opt">==</span> <span class="hl str">&quot;GBP1&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;GBP per CHF&quot;</span>
<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">D1[devisen</span><span class="hl opt">$</span><span class="hl std">D1</span> <span class="hl opt">==</span> <span class="hl str">&quot;USD1&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;USD per CHF&quot;</span>

<span class="hl com"># Delete D0</span>
<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">D0</span> <span class="hl kwb">=</span> <span class="hl kwa">NULL</span> <span class="hl com"># This is how you delete an entire column</span>

<span class="hl com"># Better column names</span>
<span class="hl kwd">names</span><span class="hl std">(devisen)</span> <span class="hl kwb">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;date&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;currency&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;value&quot;</span><span class="hl std">)</span>

<span class="hl com">#########################</span>
</pre></div>
</div></div>




<h1 id="lecture5">Lecture 5</h1>

<p>In order to speed up a bit, I provide you with some code before class. We will go through it carefully and run it during class (although it is probably more code than we can master during one lecture). Below, you just get the code, no output.</p>

<p>You can copy this code and just append it to the code we run during Lecture 4.</p>

<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># Make a plot </span>
<span class="hl kwd">hist</span><span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">value[devisen</span><span class="hl opt">$</span><span class="hl std">currency</span> <span class="hl opt">==</span> <span class="hl str">&quot;Euro per CHF&quot;</span><span class="hl std">])</span>


<span class="hl com"># Make it nicer</span>
<span class="hl kwd">hist</span><span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">value[devisen</span><span class="hl opt">$</span><span class="hl std">currency</span> <span class="hl opt">==</span> <span class="hl str">&quot;Euro per CHF&quot;</span><span class="hl std">],</span>
     <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Distribution of Euro/CHF exchange rate&quot;</span><span class="hl std">,</span>
     <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Euro/CHF&quot;</span><span class="hl std">,</span>
     <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">,</span>
     <span class="hl kwc">breaks</span> <span class="hl std">=</span> <span class="hl num">35</span><span class="hl std">)</span>

<span class="hl com"># go to color picker for hex codes!</span>


<span class="hl com"># save a plot (also works for jpeg and png)</span>
<span class="hl kwd">pdf</span><span class="hl std">(</span><span class="hl kwc">file</span> <span class="hl std">=</span> <span class="hl str">&quot;myPlot.pdf&quot;</span><span class="hl std">)</span>
  <span class="hl kwd">hist</span><span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">value[devisen</span><span class="hl opt">$</span><span class="hl std">currency</span> <span class="hl opt">==</span> <span class="hl str">&quot;Euro per CHF&quot;</span><span class="hl std">],</span>
       <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl str">&quot;Distribution of Euro/CHF exchange rate&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">xlab</span> <span class="hl std">=</span> <span class="hl str">&quot;Euro/CHF&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">col</span> <span class="hl std">=</span> <span class="hl str">&quot;#DA6704&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">breaks</span> <span class="hl std">=</span> <span class="hl num">35</span><span class="hl std">)</span>
<span class="hl kwd">dev.off</span><span class="hl std">()</span>

<span class="hl com"># See http://www.statmethods.net/advgraphs/parameters.html</span>

<span class="hl kwd">summary</span><span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">value[devisen</span><span class="hl opt">$</span><span class="hl std">currency</span> <span class="hl opt">==</span> <span class="hl str">&quot;Euro per CHF&quot;</span><span class="hl std">])</span>

<span class="hl com"># Quantiles</span>
<span class="hl kwd">quantile</span><span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">value[devisen</span><span class="hl opt">$</span><span class="hl std">currency</span> <span class="hl opt">==</span> <span class="hl str">&quot;Euro per CHF&quot;</span><span class="hl std">],</span>
         <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0.01</span><span class="hl std">,</span><span class="hl num">0.05</span><span class="hl std">,</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">0.1</span><span class="hl std">,</span><span class="hl num">0.90</span><span class="hl std">,</span><span class="hl num">0.10</span><span class="hl std">),</span><span class="hl num">0.95</span><span class="hl std">,</span> <span class="hl num">0.99</span><span class="hl std">))</span>

<span class="hl com"># You can use this with sink! But it is not possible to use sink with plots</span>

<span class="hl com">##########################################</span>

<span class="hl com"># We want to merge aussen and devisen</span>
<span class="hl com"># Problem: devisen has monthly values, </span>
<span class="hl com"># aussen has quarterly values</span>

<span class="hl com"># So what we need to do is:</span>

<span class="hl com"># 1) calculate quarterly averages of exchange rates for each currency</span>
<span class="hl com"># 2) calculate a common unique identifier for merging</span>

<span class="hl com"># In order to calculate quarterly averages, we need a variable indicating</span>
<span class="hl com"># quarters</span>

<span class="hl kwd">class</span><span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">date)</span>
<span class="hl com"># We have the date as string, need to convert it to numeric</span>
<span class="hl com"># For this, we need the stringr package</span>

<span class="hl com">#install.packages(&quot;stringr&quot;)</span>
<span class="hl kwd">library</span><span class="hl std">(</span><span class="hl str">&quot;stringr&quot;</span><span class="hl std">)</span>

<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">year</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span>  <span class="hl kwd">substr</span><span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">date,</span> <span class="hl kwc">start</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">stop</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">)  )</span>

<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">month</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span>  <span class="hl kwd">substr</span><span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">date,</span> <span class="hl kwc">start</span> <span class="hl std">=</span> <span class="hl num">6</span><span class="hl std">,</span> <span class="hl kwc">stop</span> <span class="hl std">=</span> <span class="hl num">7</span><span class="hl std">)  )</span>

<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">quarter</span> <span class="hl kwb">=</span> <span class="hl num">1</span>
<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">quarter[devisen</span><span class="hl opt">$</span><span class="hl std">month</span> <span class="hl opt">&gt;=</span><span class="hl num">4</span> <span class="hl opt">&amp;</span> <span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">month</span> <span class="hl opt">&lt;</span> <span class="hl num">7</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl num">2</span>
<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">quarter[devisen</span><span class="hl opt">$</span><span class="hl std">month</span> <span class="hl opt">&gt;=</span><span class="hl num">7</span> <span class="hl opt">&amp;</span> <span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">month</span> <span class="hl opt">&lt;</span> <span class="hl num">10</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl num">3</span>
<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">quarter[devisen</span><span class="hl opt">$</span><span class="hl std">month</span> <span class="hl opt">&gt;=</span><span class="hl num">10</span> <span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl num">4</span>

<span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">timeID</span> <span class="hl kwb">=</span> <span class="hl std">devisen</span><span class="hl opt">$</span><span class="hl std">year</span> <span class="hl opt">+</span> <span class="hl std">(devisen</span><span class="hl opt">$</span><span class="hl std">quarter</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">/</span><span class="hl num">4</span>


<span class="hl std">devisenAgg</span> <span class="hl kwb">=</span> <span class="hl kwd">aggregate</span><span class="hl std">(value</span> <span class="hl opt">~</span> <span class="hl std">timeID</span> <span class="hl opt">+</span> <span class="hl std">currency,</span>
                       <span class="hl std">devisen,</span>
                       <span class="hl std">mean)</span>

<span class="hl com"># calculate timeID also for aussen</span>

<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">year</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span>  <span class="hl kwd">substr</span><span class="hl std">(aussen</span><span class="hl opt">$</span><span class="hl std">date,</span> <span class="hl kwc">start</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">stop</span> <span class="hl std">=</span> <span class="hl num">4</span><span class="hl std">)  )</span>

<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">quarter</span> <span class="hl kwb">=</span> <span class="hl kwd">as.numeric</span><span class="hl std">(</span>  <span class="hl kwd">substr</span><span class="hl std">(aussen</span><span class="hl opt">$</span><span class="hl std">date,</span> <span class="hl kwc">start</span> <span class="hl std">=</span> <span class="hl num">7</span><span class="hl std">,</span> <span class="hl kwc">stop</span> <span class="hl std">=</span> <span class="hl num">7</span><span class="hl std">)  )</span>

<span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">timeID</span> <span class="hl kwb">=</span> <span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">year</span> <span class="hl opt">+</span> <span class="hl std">(aussen</span><span class="hl opt">$</span><span class="hl std">quarter</span><span class="hl opt">-</span><span class="hl num">1</span><span class="hl std">)</span><span class="hl opt">/</span><span class="hl num">4</span>


<span class="hl com"># Prepare new dataframe for main analysis for specific x and y data</span>
<span class="hl com">###################################################################</span>

<span class="hl kwd">unique</span><span class="hl std">(aussen</span><span class="hl opt">$</span><span class="hl std">cuItem)</span>
<span class="hl kwd">unique</span><span class="hl std">(aussen</span><span class="hl opt">$</span><span class="hl std">sector)</span>
<span class="hl kwd">unique</span><span class="hl std">(aussen</span><span class="hl opt">$</span><span class="hl std">measure)</span>

<span class="hl std">xData</span> <span class="hl kwb">=</span> <span class="hl std">devisenAgg[devisenAgg</span><span class="hl opt">$</span><span class="hl std">currency</span> <span class="hl opt">==</span> <span class="hl str">&quot;Euro per CHF&quot;</span><span class="hl std">, ]</span>
<span class="hl std">yData</span> <span class="hl kwb">=</span> <span class="hl std">aussen[aussen</span><span class="hl opt">$</span><span class="hl std">caItem</span> <span class="hl opt">==</span> <span class="hl str">&quot;Ausfuhr&quot;</span> <span class="hl opt">&amp;</span>
               <span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">sector</span> <span class="hl opt">==</span> <span class="hl str">&quot;Total&quot;</span> <span class="hl opt">&amp;</span>
               <span class="hl std">aussen</span><span class="hl opt">$</span><span class="hl std">measure</span> <span class="hl opt">==</span> <span class="hl str">&quot;Vernderung real&quot;</span><span class="hl std">, ]</span>

<span class="hl std">Data</span> <span class="hl kwb">=</span> <span class="hl kwd">merge</span><span class="hl std">(xData, yData,</span> <span class="hl kwc">by</span> <span class="hl std">=</span> <span class="hl str">&quot;timeID&quot;</span><span class="hl std">)</span>

<span class="hl kwd">names</span><span class="hl std">(Data)[</span><span class="hl kwd">names</span><span class="hl std">(Data)</span> <span class="hl opt">==</span> <span class="hl str">&quot;value.x&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;xrateValue&quot;</span>

<span class="hl kwd">names</span><span class="hl std">(Data)[</span><span class="hl kwd">names</span><span class="hl std">(Data)</span> <span class="hl opt">==</span> <span class="hl str">&quot;value.y&quot;</span><span class="hl std">]</span> <span class="hl kwb">=</span> <span class="hl str">&quot;caItemValue&quot;</span>

<span class="hl kwd">plot</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">xrateValue, Data</span><span class="hl opt">$</span><span class="hl std">caItemValue)</span>
</pre></div>
</div></div>




<h1 id="lecture6">Lecture 6</h1>

<p>As in the case of the previous lecture, I provide you with the code beforehand. We will continue in the same script file that we used during Lecture 4 and 5. So just copy the below code and append it to this file.</p>

<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">##########################################################</span>

<span class="hl com"># The basline plot is too basic, we want a better one. For this, we need a new package,</span>
<span class="hl com"># called ggplot2</span>
<span class="hl com">#install.packages(&quot;ggplot2&quot;) #As usual, run this only once on any device</span>

<span class="hl com"># Call the package for our current session</span>
<span class="hl kwd">library</span><span class="hl std">(</span><span class="hl str">&quot;ggplot2&quot;</span><span class="hl std">)</span>

<span class="hl com"># Here are different versions of plots you can create with ggplot</span>
<span class="hl kwd">ggplot</span><span class="hl std">(Data,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= xrateValue,</span> <span class="hl kwc">y</span> <span class="hl std">= caItemValue))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_point</span><span class="hl std">()</span>


<span class="hl kwd">pdf</span><span class="hl std">(</span><span class="hl kwc">file</span> <span class="hl std">=</span> <span class="hl str">&quot;myPlot.pdf&quot;</span><span class="hl std">)</span>
<span class="hl kwd">ggplot</span><span class="hl std">(Data,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= xrateValue,</span> <span class="hl kwc">y</span> <span class="hl std">= caItemValue))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_point</span><span class="hl std">()</span>
<span class="hl kwd">dev.off</span><span class="hl std">()</span>


<span class="hl kwd">pdf</span><span class="hl std">(</span><span class="hl kwc">file</span> <span class="hl std">=</span> <span class="hl str">&quot;myPlot.pdf&quot;</span><span class="hl std">)</span>
<span class="hl kwd">ggplot</span><span class="hl std">(Data,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= xrateValue,</span> <span class="hl kwc">y</span> <span class="hl std">= caItemValue))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_point</span><span class="hl std">()</span> <span class="hl opt">+</span>
  <span class="hl kwd">xlab</span><span class="hl std">(</span><span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">currency))</span> <span class="hl opt">+</span>
  <span class="hl kwd">ylab</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">caItem),</span> <span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">sector),</span> <span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">measure)))</span>
<span class="hl com">#  ylab(paste(unique(Data$caItem), &quot;-&quot;, unique(Data$sector), &quot;-&quot;, unique(Data$measure)))</span>
<span class="hl kwd">dev.off</span><span class="hl std">()</span>

<span class="hl kwd">png</span><span class="hl std">(</span><span class="hl kwc">file</span> <span class="hl std">=</span> <span class="hl str">&quot;myPlot.png&quot;</span><span class="hl std">)</span>
<span class="hl kwd">ggplot</span><span class="hl std">(Data,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= xrateValue,</span> <span class="hl kwc">y</span> <span class="hl std">= caItemValue))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_point</span><span class="hl std">()</span> <span class="hl opt">+</span>
  <span class="hl kwd">xlab</span><span class="hl std">(</span><span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">currency))</span> <span class="hl opt">+</span>
  <span class="hl kwd">ylab</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">caItem),</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">sector),</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">measure)))</span> <span class="hl opt">+</span>
  <span class="hl kwd">ggtitle</span><span class="hl std">(</span><span class="hl str">&quot;Meine erste coole Graphik&quot;</span><span class="hl std">)</span>
<span class="hl kwd">dev.off</span><span class="hl std">()</span>


<span class="hl kwd">jpeg</span><span class="hl std">(</span><span class="hl kwc">file</span> <span class="hl std">=</span> <span class="hl str">&quot;myPlot.jpeg&quot;</span><span class="hl std">)</span>
<span class="hl kwd">ggplot</span><span class="hl std">(Data,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= xrateValue,</span> <span class="hl kwc">y</span> <span class="hl std">= caItemValue))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_point</span><span class="hl std">(</span><span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">xlab</span><span class="hl std">(</span><span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">currency))</span> <span class="hl opt">+</span>
  <span class="hl kwd">ylab</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">caItem),</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">sector),</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">measure)))</span> <span class="hl opt">+</span>
  <span class="hl kwd">ggtitle</span><span class="hl std">(</span><span class="hl str">&quot;Meine erste coole Graphik&quot;</span><span class="hl std">)</span>
<span class="hl kwd">dev.off</span><span class="hl std">()</span>


<span class="hl kwd">jpeg</span><span class="hl std">(</span><span class="hl kwc">file</span> <span class="hl std">=</span> <span class="hl str">&quot;myPlot.jpeg&quot;</span><span class="hl std">)</span>
<span class="hl kwd">ggplot</span><span class="hl std">(Data,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= xrateValue,</span> <span class="hl kwc">y</span> <span class="hl std">= caItemValue))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_point</span><span class="hl std">(</span><span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">&quot;red&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_smooth</span><span class="hl std">(</span><span class="hl kwc">method</span> <span class="hl std">= lm,</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">&quot;#66ffff&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">xlab</span><span class="hl std">(</span><span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">currency))</span> <span class="hl opt">+</span>
  <span class="hl kwd">ylab</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">caItem),</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">sector),</span> <span class="hl str">&quot;-&quot;</span><span class="hl std">,</span> <span class="hl kwd">unique</span><span class="hl std">(Data</span><span class="hl opt">$</span><span class="hl std">measure)))</span> <span class="hl opt">+</span>
  <span class="hl kwd">ggtitle</span><span class="hl std">(</span><span class="hl str">&quot;Meine erste coole Graphik&quot;</span><span class="hl std">)</span>
<span class="hl kwd">dev.off</span><span class="hl std">()</span>


<span class="hl com"># And, finally, run a regression</span>

<span class="hl kwd">lm</span><span class="hl std">(xrateValue</span> <span class="hl opt">~</span> <span class="hl std">caItemValue, Data)</span>

<span class="hl kwd">sink</span><span class="hl std">(</span><span class="hl str">&quot;regOutput.txt&quot;</span><span class="hl std">,</span> <span class="hl kwc">append</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl kwd">summary</span><span class="hl std">(</span><span class="hl kwd">lm</span><span class="hl std">(xrateValue</span> <span class="hl opt">~</span> <span class="hl std">caItemValue, Data))</span>
<span class="hl kwd">sink</span><span class="hl std">()</span>
<span class="hl kwd">file.show</span><span class="hl std">(</span><span class="hl str">&quot;regOutput.txt&quot;</span><span class="hl std">)</span>



<span class="hl com">########################################################</span>

<span class="hl com"># Preparations for using RMarkdown</span>
<span class="hl com">##################################</span>

<span class="hl com"># This is how you save selected R objects putting them into a &quot;basket&quot; with </span>
<span class="hl com"># a common name</span>
<span class="hl kwd">save</span><span class="hl std">(aussen, devisenAgg,</span> <span class="hl kwc">file</span> <span class="hl std">=</span> <span class="hl str">&quot;dataForAnalysis.Rdata&quot;</span><span class="hl std">)</span>
</pre></div>
</div></div>


<h2 id="lecture6_rmarkdown">R Markdown</h2>

<p>An important goal of this lecture is also to introduce you to <code>R Markdown</code>. This is a powerful documentation tool that allows you to automate important parts of the documentation process. The idea is that if you change your sample (e.g. because you got a better idea about how to run your regression), you do not want each time to manually copy the regression results and graphics into, say, a Word document. Much better if everything ends up in a document automatically (I don't think you can disagree with that&hellip;).</p>

<p>In order to run R Markdown, you need to install extra R packages. With these packages, you can compile to html format, i.e. the output will look like a website. If you also want to compile to pdf format, you need to install Latex (or also simply called TeX). I have prepared an <a href = "pdfs/Installing RMarkdown.pdf" target="_blank">extra document</a> with lots of screenshots that guide you through the installation process on a Mac and on Windows. While installation of the necessary R packages is very quick, installing Latex takes about one half to one hour, or even more. Make sure you have a good Internet connection. We will install the necessary R packages together during Lecture 6. I leave the installation of Latex to you as an assignment. Using the screenshots shown under the above link, it should be pretty straightforward, if only you need some patience.
</p>

<p>On Windows machines it is also possible to compile to MS Word. On a Mac machine this may also be the case, but you need to have some luck. So if you work with a Mac, html or pdf is probably your menu.</p>

<p>With a html document, you can in fact make a website! The easiest way to do this is to use Dropbox &ndash; it's for free (Google Drive also offers an option, but only until Summer 2016). Sign up for Dropbox (if you have not already done so), otherwise just sign in to the web version of Dropbox. Upload your html file to whereever you like on your Dropbox, using the web version. Click on <code>Share</code>. A prompt window gets opened with a web address, e.g. <a href = "https://www.dropbox.com/s/2vdg1jdwpo6utem/Lecture6BEFORELIVE.html?dl=0", target = "_blank">https://www.dropbox.com/s/2vdg1jdwpo6utem/Lecture6BEFORELIVE.html?dl=0</a>. You can use this, but it's probably not quite what you want. Here is the ultimate trick. Substitute the <code>www</code> by <code>dl</code> to <a href = "https://dl.dropbox.com/s/2vdg1jdwpo6utem/Lecture6BEFORELIVE.html?dl=0", target = "_blank">https://dl.dropbox.com/s/2vdg1jdwpo6utem/Lecture6BEFORELIVE.html?dl=0</a>. Voil&agrave;!
</p>



<p>With R Markdown, you edit your document in the so-called markdown language and then compile it to either html, pdf, or MS Word format. We will look at this during class. Again, I prepared code and text beforehand, which you find below (R Markdown text/code is indicated by a reddish background, while R code is always indicated by a bluish background) in this web lecture notes.</p>



<pre style="margin-left:50px; padding:10px;
background-color:#ffe6e6;"><code>


---
title: "Lecture 6 Introduction to R Markdown"
author: "Johannes Binswanger"
date: "March 31, 2016"
output: html_document
---

One warning first. If you use a German date format in the header with a period after the number, like "31. Mrz 2016", then the compilation to pdf will not work.

Here is some code taken from Lecture 5.

<!-- This here is my private comment, no one will see it ;-) -->


```{r}

load("dataForAnalysis.Rdata")
xData = devisenAgg[devisenAgg$currency == "Euro per CHF", ]
yData = aussen[aussen$caItem == "Ausfuhr" &
               aussen$sector == "Total" &
               aussen$measure == "Vernderung real", ]

Data = merge(xData, yData, by = "timeID")

names(Data)[names(Data) == "value.x"] = "xrateValue"

names(Data)[names(Data) == "value.y"] = "caItemValue"


```
Below, we paste exactly the same code, but add the option `echo = FALSE`. So do you see anything?

```{r, echo=FALSE}

load("dataForAnalysis.Rdata")
xData = devisenAgg[devisenAgg$currency == "Euro per CHF", ]
yData = aussen[aussen$caItem == "Ausfuhr" &
               aussen$sector == "Total" &
               aussen$measure == "Vernderung real", ]

Data = merge(xData, yData, by = "timeID")

names(Data)[names(Data) == "value.x"] = "xrateValue"

names(Data)[names(Data) == "value.y"] = "caItemValue"




```


```{r, echo=FALSE}

library("ggplot2")

ggplot(Data, aes(x = xrateValue, y = caItemValue)) +
  geom_point(color = "red") +
  geom_smooth(method = lm, color = "#66ffff", size = 1) +
  xlab(unique(Data$currency)) +
  ylab(paste(unique(Data$caItem), "-", unique(Data$sector), "-", unique(Data$measure))) +
  ggtitle("Meine erste coole Graphik")

```


The regression results are:
```{r, echo=FALSE}

reg = lm(xrateValue ~ caItemValue, Data)

summary(reg)

```


Maybe you like it better this way...


```{r, echo=FALSE, comment="\t\t"}

lm(xrateValue ~ caItemValue, Data)
reg = lm(xrateValue ~ caItemValue, Data)

summary(reg)

```


The regression object has the following elements:
```{r, echo=FALSE}
names(reg)
```


The coefficients are `r reg$coefficients`. This looks pretty ugly. Let's try to do it better...

The coefficients of our regression models are:

* The intercept is `r round(reg$coefficients[1], digits = 3)`.
* The coefficient on `r paste(unique(Data$caItem), "-", unique(Data$sector), "-", unique(Data$measure))` is `r round(reg$coefficients[2], digits = 3)`.


You can also put it in a nicer looking table:

```{r, echo = FALSE}

pvals = round(summary(reg)$coefficients[,4], digits = 3)

```


| Coefficient        | Point estimate           | p-value  |
| ------------- |:-------------:| -----:|
| Intercept | `r round(reg$coefficients[1], digits = 3)` | `r pvals[1]`|
| Exports |`r round(reg$coefficients[2], digits = 3)`    |   `r pvals[2]` | 


**If you rerun your regression models with different data, the coefficients are automatically adjusted.** Let's illustrate this by rerunning the regressions only with observations more from 2007 to 2015:

```{r, echo=FALSE, comment="\t\t"}

reg = lm(xrateValue ~ caItemValue, Data[Data$year>2006, ])



```

The coefficients of our regression models are now (With exactly the same lines of R Markdown code):

* The intercept is `r round(reg$coefficients[1], digits = 3)`.
* The coefficient on `r paste(unique(Data$caItem), "-", unique(Data$sector), "-", unique(Data$measure))` is `r round(reg$coefficients[2], digits = 3)`.

And the table is now:

```{r, echo = FALSE}

pvals = round(summary(reg)$coefficients[,4], digits = 3)

```


| Coefficient        | Point estimate           | p-value  |
| ------------- |:-------------:| -----:|
| Intercept | `r round(reg$coefficients[1], digits = 3)` | `r pvals[1]`|
| Exports |`r round(reg$coefficients[2], digits = 3)`    |   `r pvals[2]` | 



*Even equations are possible:*

$$\int_{-\infty}^{\infty}xf(x)dx= 1$$.



</code></pre>




<h1 id="lecture7_8">Lectures 7 and 8</h1>

<p>You've got already a pretty good overview of what R is able to do for preparing data sets and analyzing and visualizing them. In the remaining two lectures, we discuss a few important topics that we have not dealt with so far. These are:
<ul>
<li>Converting data sets from <i>long</i> to <i>wide</i> format and back (using the functions <code>dcast</code> and <code>melt</code> of the <code>reshape2</code> package);
<li>Calculating growth rates and lagged values of variables (very important in economics);
<li>Functions.
</ul>
</p>

<p>As in the previous lectures, I will provide you with the code beforehand. We'll discuss and run it together in class. It's lots of code, hopefully we'll have time for all of it. If not, you can always run it on your own. Note: You will need the <code>rdata</code> object <code>dataForAnalysis</code> that we built at the end of Lecture 6. Make sure you know in which directory you have it, and have it ready!</p>

<p>And here we go &hellip; I already placed many comments.</p>

<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">###########################</span>
<span class="hl com">#### Code <span class="hl kwa">for</span> LECTURE 7 ###</span>
<span class="hl com">###########################</span>

# Topics <span class="hl kwa">for</span> <span class="hl kwd">this</span> (and the <span class="hl kwa">next</span>) lecture:
# - convert data formats from <span class="hl str">'long'</span> to <span class="hl str">'wide'</span> and vice versa
<span class="hl com"># - calculate gowth rates and lags</span>
<span class="hl com"># - functions</span>


<span class="hl com"># To begin with, we copy a few lines of pevious code.</span>
<span class="hl com"># Take the first lines of code that we copied</span>
# into the RMarkdown <span class="hl kwd">file</span> (which you find <span class="hl kwa">in</span> the
# online script under Lecture 6 and the heading <span class="hl str">&quot;R Markdown&quot;</span>),
# the first chunk of <span class="hl str">'real'</span> code from he section with the reddish
<span class="hl com"># background. </span>


<span class="hl com"># And do not forget to add two more things:</span>
<span class="hl com"># (1) Your working directory</span>
<span class="hl com"># (2) a clean-up line, so we can</span>
<span class="hl com">#     rerun the code whenever we wich without having to worry</span>
<span class="hl com">#     about things gettung messed up</span>

<span class="hl kwd">rm</span>(list = <span class="hl kwd">ls</span>()) # Clean-up line

<span class="hl com"># Working directory</span>
<span class="hl com"># !!! REPLACE THIS WITH WHAT FITS IN YOUR SITUATION !!!</span>
<span class="hl kwd">setwd</span>(<span class="hl str">&quot;~/Desktop/MacWork/Programmieren fr Praxis/KursLiveMac&quot;</span>) 
<span class="hl kwd">setwd</span>(<span class="hl str">&quot;D:/Dropbox/Mac&amp;Surf/KursLiveDropb&quot;</span>)

<span class="hl kwd">load</span>(<span class="hl str">&quot;dataForAnalysis.Rdata&quot;</span>)

<span class="hl com"># So now we are ready <span class="hl kwa">for</span> new things...</span>

<span class="hl com"># SWITCHING BETWEEN LONG AND WIDE FORMAT</span>
<span class="hl com">########################################</span>

<span class="hl com"># Have a look at the dataframe devisenAgg.</span>
# It<span class="hl str">'s <span class="hl kwa">in</span> '</span>long<span class="hl str">' format. All '</span>variables' <span class="hl kwa">in</span> the 
# statstical <span class="hl kwd">sense</span> (not the programming sense) are
# stacked <span class="hl kwd">vertically</span> (the different exchange rates).
# We want a <span class="hl str">'lazy'</span> method to convert this into the
# <span class="hl str">'wide'</span> format. So it will look like you are used to.

<span class="hl com"># we first need a package: reshape 2</span>
# <span class="hl kwd">install.packages</span>(<span class="hl str">&quot;reshape2&quot;</span>)
<span class="hl kwd">library</span>(reshape2)

<span class="hl com"># From long to wide, you use the dcast <span class="hl kwa">function</span>.</span>
<span class="hl com"># Althougn very powerful, it is a bit tricky to understand</span>
<span class="hl com"># Normally, you will experiment a few times before you </span>
<span class="hl com"># have what you want.</span>

<span class="hl com"># You can find a good introduction to the functions of reshape2 on</span>
<span class="hl com"># http://seananderson.ca/2013/10/19/reshape.html</span>



Wide = <span class="hl kwd">dcast</span>(devisenAgg, # the data frame
                    timeID ~ <span class="hl com"># the variable that is to</span>
                             # <span class="hl str">'IDENTIFY'</span> ROWS of new
                             # variables! Note the <span class="hl str">'~'</span>!
                      currency , <span class="hl com"># the column containing </span>
                                 <span class="hl com"># what you want to become</span>
                                 <span class="hl com"># the new variable NAMES </span>
        value.var = <span class="hl str">&quot;value&quot;</span>)  # column that contains the 
                            <span class="hl com"># VALUES of the new variables</span>
                            <span class="hl com"># (often, you can ommit this)</span>
                                
<span class="hl com"># This shortcut version also often works</span>
Wide1 = <span class="hl kwd">dcast</span>(devisenAgg, timeID ~ currency)

# Note, the column <span class="hl str">'currency'</span> disappeared. 
<span class="hl com"># It served as source <span class="hl kwa">for</span> the new variable names!</span>

<span class="hl com"># Note that the new variable names have spaces, </span>
<span class="hl com"># so we cannot refer to them <span class="hl kwa">in</span> the usual way</span>

<span class="hl kwd">summary</span>(Wide$Euro per CHF) # Does not work

<span class="hl com"># But this works:</span>
<span class="hl kwd">summary</span>(Wide$`Euro per CHF`)

<span class="hl kwd">summary</span>(devisenWide[[<span class="hl str">&quot;Euro per CHF&quot;</span>]])

<span class="hl com"># To learn about cast, see what other arrangements do</span>

<span class="hl com"># Invert order</span>
test = <span class="hl kwd">dcast</span>(devisenAgg, currency ~ timeID)
<span class="hl kwd">names</span>(test)

test = <span class="hl kwd">dcast</span>(devisenAgg, timeID ~ value)

test = <span class="hl kwd">dcast</span>(devisenAgg, value ~ currency)

<span class="hl com"># All not very useful...</span>


<span class="hl com"># Now let's invert this, from wide to long</span>

Melt = <span class="hl kwd">melt</span>(Wide, id.vars = <span class="hl str">&quot;timeID&quot;</span>)
<span class="hl com"># Note, the id.vars indicates the variable that</span>
<span class="hl com"># identified the rows <span class="hl kwa">in</span> the wide format</span>


<span class="hl com">############################################################</span>

<span class="hl com"># Now let's look at something more complicated:</span>
# The <span class="hl str">'aussen'</span> dataframe

<span class="hl com"># Clean up first</span>
<span class="hl kwd">rm</span>(Wide, Wide1, test, Melt)

<span class="hl com"># Now we will have more than one variable</span>
<span class="hl com"># to define new variables!</span>


Wide = <span class="hl kwd">dcast</span>(aussen, 
              timeID  ~
                caItem + sector + measure,
              value.var = <span class="hl str">&quot;value&quot;</span>)

<span class="hl com"># If you are bothered by the upper-case <span class="hl kwa">letters</span> use</span>

<span class="hl kwd"><span class="hl kwa">for</span></span> (i <span class="hl kwa">in</span> 1:<span class="hl kwd">length</span>(<span class="hl kwd">names</span>(Wide))){
  <span class="hl kwd">names</span>(Wide)[i] = <span class="hl kwd">tolower</span>(<span class="hl kwd">names</span>(Wide)[i])
}

<span class="hl com"># If you want to manipulate the names further,</span>
# e.g. by removing the <span class="hl str">'_'</span> or spaces,
# use the stringr <span class="hl kwd">packes</span> (which we have already used)
<span class="hl com"># We will do so below.</span>


# To make a <span class="hl str">'codebook'</span> use
<span class="hl kwd">sink</span>(<span class="hl str">&quot;Codebook.txt&quot;</span>)
<span class="hl kwd">cat</span>(<span class="hl kwd">toupper</span>(<span class="hl str">&quot;\nThe variables <span class="hl kwa">in</span> the <span class="hl str">'Wide'</span> data set are:\n\n&quot;</span>))

<span class="hl kwd"><span class="hl kwa">for</span></span> (i <span class="hl kwa">in</span> 1:<span class="hl kwd">length</span>(<span class="hl kwd">names</span>(Wide))){
  <span class="hl kwd">cat</span>(<span class="hl str">&quot;[&quot;</span>, i, <span class="hl str">&quot;]&quot;</span>, <span class="hl str">&quot;\t&quot;</span>, <span class="hl kwd">names</span>(Wide)[i],  <span class="hl str">&quot;\n\n&quot;</span>, sep=<span class="hl str">&quot;&quot;</span>)
}
<span class="hl kwd">sink</span>()
#<span class="hl kwd">file.show</span>(<span class="hl str">&quot;Codebook.txt&quot;</span>)

<span class="hl com"># Back to dcast...</span>
<span class="hl com">###################</span>

<span class="hl com">#You can also have multiple variables on the </span>
<span class="hl com"># row identification side</span>

Wide1 = <span class="hl kwd">dcast</span>(aussen, 
             year + quarter  ~
               caItem + sector + measure,
             value.var = <span class="hl str">&quot;value&quot;</span>)


<span class="hl com"># And now melt</span>

Melt = <span class="hl kwd">melt</span>(Wide, id.vars = <span class="hl str">&quot;timeid&quot;</span>)

<span class="hl com"># And with multiple id variables:</span>
Melt1 = <span class="hl kwd">melt</span>(Wide1, id.vars = <span class="hl kwd">c</span>(<span class="hl str">&quot;year&quot;</span>, <span class="hl str">&quot;quarter&quot;</span>))

<span class="hl com">#################################################################################</span>

<span class="hl com"># GROWTH RATES AND LAGS</span>
<span class="hl com">#######################</span>

<span class="hl com"># We have already looked at how CHF/Euro-exchange rates are associated</span>
<span class="hl com"># with changes <span class="hl kwa">in</span> exports. However, is it really the LEVELS of exchange</span>
<span class="hl com"># rates that affect changes <span class="hl kwa">in</span> exports? Maybe it's rather the CHANGES</span>
<span class="hl com"># <span class="hl kwa">in</span> exchange rates? We got the changes <span class="hl kwa">in</span> exports directly from the SNB data.</span>
<span class="hl com"># But we have to calculate the changes <span class="hl kwa">in</span> exchange rates ourselves... How?</span>

<span class="hl com"># To get the idea, look at the following</span>
x = 1:10

<span class="hl kwd">tail</span>(x, -1)
<span class="hl kwd">head</span>(x, -1)

gx = (  <span class="hl kwd">tail</span>(x, -1) / <span class="hl kwd">head</span>(x, -1) 
      - 1)*100 <span class="hl com">#convert to percentage values</span>


<span class="hl com"># We can use the very same trick <span class="hl kwa">for</span> lags, <span class="hl kwa">in</span> fact, we already have the solution.</span>
<span class="hl com"># But why lags? Well, it may take some time before exchanges rates affect exports</span>
<span class="hl com"># Existing projects will not just be cancelled on January 16 2015. Probably most contracts</span>
<span class="hl com"># Prevent businesses from doing so. But there may be less NEW contracts</span>
<span class="hl com"># To get this effect statistically, you need LAGS.</span>

<span class="hl com"># It's done like so:</span>
lx = <span class="hl kwd">head</span>(x, -1)
<span class="hl com"># But this is shorter than x, so it would not fit into a </span>
<span class="hl com"># dataframe where all variables need to have the same length.</span>
<span class="hl com"># Here is the solution</span>

lx = <span class="hl kwd">c</span>(<span class="hl kwa">NA</span>, <span class="hl kwd">head</span>(x, -1))

<span class="hl com"># and we'll actually have to do the same <span class="hl kwa">for</span> growth rates</span>
<span class="hl com"># Add a missing first value</span>
gx = <span class="hl kwd">c</span>(<span class="hl kwa">NA</span>, gx)


xData = <span class="hl kwd">cbind</span>(x, lx, gx)


<span class="hl com"># Digression: Functions</span>
<span class="hl com">#######################</span>

<span class="hl com"># It is time to get familiar with fuctions. Functions </span>
# <span class="hl str">'outsource'</span> bits of code that you need quite often
<span class="hl com"># but do not want to type every time you need it.</span>
<span class="hl com"># This is also smart. If you make a mistake, you just correct</span>
<span class="hl com"># it once  instead of searching through an entire document of a</span>
<span class="hl com"># thousand lines of code where you repeated the same chunk about 31</span>
<span class="hl com"># times. Moreover, and maybe even more important, functions can have</span>
<span class="hl com"># arguments that VARY!</span>

<span class="hl com"># When you become better at programming and write more complex programs</span>
<span class="hl com"># you will use functions more and more. At the beginning they seem to </span>
<span class="hl com"># make code more dense and opague. But eventually you will greatly appreciate.</span>
<span class="hl com"># At some point <span class="hl kwa">if</span> you want to become a good programmer, you make it a habit</span>
# to convert many pieces of code into a <span class="hl kwa">function</span>. So you get this <span class="hl str">'into your fingers'</span>.


<span class="hl com"># Calculating lags is used quite often. And you may need various lags,</span>
<span class="hl com"># As you don't know how long it takes <span class="hl kwa">for</span> a variable to have an effect!</span>

<span class="hl com"># Give functions a name that easily indicates what they are</span>
<span class="hl com"># doing and that indicate that it's a <span class="hl kwa">function</span>.</span>
# Use <span class="hl str">&quot;to&quot;</span>, <span class="hl str">&quot;get&quot;</span>, or <span class="hl str">&quot;_fun&quot;</span> etc.
toLag = <span class="hl kwd"><span class="hl kwa">function</span></span>(var, lag) {
  out = <span class="hl kwd">c</span>(<span class="hl kwd">rep</span>(<span class="hl kwa">NA</span>, lag), <span class="hl kwd">head</span>(var, -lag))
}

y = <span class="hl kwd">toLag</span>(1:10, 2)
y

<span class="hl com"># Let's also get a first idea of what is</span>
<span class="hl com"># called the SCOPE of a variable</span>
<span class="hl com"># We just used the <span class="hl kwa">function</span> toLag, so R calculated the variable</span>
<span class="hl com"># out. Let's see:</span>

out  <span class="hl com"># Why does R not know it??</span>

<span class="hl com"># out is known to R only inside the <span class="hl kwa">function</span>, i.e. inside the </span>
# <span class="hl str">'{}'</span> of the <span class="hl kwa">function</span>. This is the SCOPE of that variable!


<span class="hl com"># Another <span class="hl kwa">function</span></span>

toGrowth = <span class="hl kwd"><span class="hl kwa">function</span></span>(x) {
  out = ( <span class="hl kwd">tail</span>(x, -1) / <span class="hl kwd">head</span>(x, -1)
          -1)*100
  out = <span class="hl kwd">c</span>(<span class="hl kwa">NA</span>, out)
}


<span class="hl com">#######################################################################################</span>

<span class="hl com"># Calculating growth rates and lags <span class="hl kwa">for</span> our data</span>
<span class="hl com">################################################</span>

<span class="hl com">#Let's again practice the reshaping of data and merging them</span>

xData = <span class="hl kwd">dcast</span>(devisenAgg, timeID ~ currency, value.var = <span class="hl str">&quot;value&quot;</span>)

yData = <span class="hl kwd">dcast</span>(aussen, timeID ~ caItem +  sector + measure, value.var = <span class="hl str">&quot;value&quot;</span>)

mainData = <span class="hl kwd">merge</span>(xData, yData, by = <span class="hl str">&quot;timeID&quot;</span>)

# Correct column <span class="hl kwd">names</span> (exchange rates are the wrong way around!!!)
<span class="hl com"># And let's see how cool utf-8 coding is!!!</span>

<span class="hl kwd">names</span>(mainData)[<span class="hl kwd">names</span>(mainData) == <span class="hl str">&quot;Euro per CHF&quot;</span>] = <span class="hl str">&quot;CHF pro \u20ac&quot;</span>
<span class="hl kwd">names</span>(mainData)[<span class="hl kwd">names</span>(mainData) == <span class="hl str">&quot;USD per CHF&quot;</span>] = <span class="hl str">&quot;CHF pro \u0024&quot;</span>
<span class="hl kwd">names</span>(mainData)[<span class="hl kwd">names</span>(mainData) == <span class="hl str">&quot;GBP per CHF&quot;</span>] = <span class="hl str">&quot;CHF pro \u00a3&quot;</span>


<span class="hl com"># Calculate growth rates <span class="hl kwa">for</span> exchange rates</span>
mainData[[<span class="hl str">&quot;CHF pro <span class="hl kwd">\u20ac</span> (Ver\u00e4nderung)&quot;</span>]] = <span class="hl kwd">toGrowth</span>(mainData[[<span class="hl str">&quot;CHF pro \u20ac&quot;</span>]])

mainData[[<span class="hl str">&quot;CHF pro <span class="hl kwd">\u0024</span> (Ver\u00e4nderung)&quot;</span>]] = <span class="hl kwd">toGrowth</span>(mainData[[<span class="hl str">&quot;CHF pro \u0024&quot;</span>]])

mainData[[<span class="hl str">&quot;CHF pro <span class="hl kwd">\u00a3</span> (Ver\u00e4nderung)&quot;</span>]] = <span class="hl kwd">toGrowth</span>(mainData[[<span class="hl str">&quot;CHF pro \u00a3&quot;</span>]])

<span class="hl com"># And a lag</span>

lag = 1

mainData[[<span class="hl kwd">paste0</span>(<span class="hl str">&quot;CHF pro <span class="hl kwd">\u20ac</span> (Ver\u00e4nderung, Lag: &quot;</span>, lag, <span class="hl str">&quot; <span class="hl kwd">Quartal</span>(e))&quot;</span>)]] = 
    <span class="hl kwd">toLag</span>(mainData[[<span class="hl str">&quot;CHF pro <span class="hl kwd">\u20ac</span> (Ver\u00e4nderung)&quot;</span>]], lag)

mainData[[<span class="hl kwd">paste0</span>(<span class="hl str">&quot;CHF pro <span class="hl kwd">\u0024</span> (Ver\u00e4nderung, Lag: &quot;</span>, lag, <span class="hl str">&quot; <span class="hl kwd">Quartal</span>(e))&quot;</span>)]] = 
  <span class="hl kwd">toLag</span>(mainData[[<span class="hl str">&quot;CHF pro <span class="hl kwd">\u0024</span> (Ver\u00e4nderung)&quot;</span>]], lag)

mainData[[<span class="hl kwd">paste0</span>(<span class="hl str">&quot;CHF pro <span class="hl kwd">\u00a3</span> (Ver\u00e4nderung, Lag: &quot;</span>, lag, <span class="hl str">&quot; <span class="hl kwd">Quartal</span>(e))&quot;</span>)]] = 
  <span class="hl kwd">toLag</span>(mainData[[<span class="hl str">&quot;CHF pro <span class="hl kwd">\u00a3</span> (Ver\u00e4nderung)&quot;</span>]], lag)


<span class="hl com"># Relocate this block of new variables</span>

mainData = mainData[, <span class="hl kwd">c</span>(<span class="hl kwd">names</span>(mainData[1:4]),
             <span class="hl kwd">names</span>(mainData[24:29]),
             <span class="hl kwd">names</span>(mainData[5:23])
             )]
<span class="hl com"># If you want to change lags, all you have to do is to reset the lag </span>
<span class="hl com"># value above, just one number to retype!!! All the rest will be</span>
<span class="hl com"># done automatically, including renaming of variables!!!</span>


# Make variable names nicer by removing <span class="hl str">'_'</span>

<span class="hl kwd">library</span>(stringr)

<span class="hl com"># To see the idea, it's extremely easy!</span>

x = <span class="hl str">&quot;this_and_that&quot;</span>
<span class="hl kwd">str_replace_all</span>(x, <span class="hl str">&quot;_&quot;</span>, <span class="hl str">&quot; &quot;</span>)

<span class="hl com"># Now the real thing</span>
<span class="hl kwd">names</span>(mainData) = <span class="hl kwd">str_replace_all</span>(<span class="hl kwd">names</span>(mainData), <span class="hl str">&quot;_&quot;</span>, <span class="hl str">&quot; &quot;</span>)



<span class="hl com"># Time to visualize the data and to run regressions!</span>
<span class="hl com">####################################################</span>

<span class="hl com"># We previously used ggplot. However, that package is not</span>
<span class="hl com"># good at handling variable names with spaces and utf-8 characters</span>
<span class="hl com"># On the other hand, I like these variable names since I can directly</span>
<span class="hl com"># use it <span class="hl kwa">for</span> getting nice legends and axis labels without having</span>
<span class="hl com"># to convert ugly variable names like xRateEuroCHF etc.</span>

<span class="hl com"># So we use the base version of plots. This is a bit more involved</span>
<span class="hl com"># than ggplot when you really want to make nice graphs. But why not</span>
<span class="hl com"># have a look at it. Personally, I really like it.</span>

xvar =<span class="hl kwd">paste0</span>(<span class="hl str">&quot;CHF pro <span class="hl kwd">\u20ac</span> (Ver\u00e4nderung, Lag: &quot;</span>, lag, <span class="hl str">&quot; <span class="hl kwd">Quartal</span>(e))&quot;</span>)
yvar = <span class="hl str">&quot;Ausfuhr Total Vernderung real&quot;</span>
col1 = <span class="hl str">&quot;#009999&quot;</span>
col2 = <span class="hl str">&quot;red3&quot;</span>

<span class="hl kwd">png</span>(<span class="hl str">&quot;myPlot.png&quot;</span>, width = 800, height = 550)
<span class="hl kwd">plot</span>( mainData[[xvar]], mainData[[yvar]], 
     xlab=xvar, ylab=yvar,
     pch = 19, col = col1,
     main = <span class="hl kwd">paste</span>(yvar, <span class="hl str">&quot;und\n&quot;</span>, xvar))
<span class="hl kwd">grid</span>()

<span class="hl kwd">abline</span>(<span class="hl kwd">lm</span>(mainData[[yvar]]~mainData[[xvar]]), col=col2, lwd = 3) 

reg = <span class="hl kwd">lm</span>(mainData[[yvar]]~mainData[[xvar]])
sumreg = <span class="hl kwd">summary</span>(reg)
r2 = <span class="hl kwd">round</span>(sumreg$r.squared, digits = 3)
slope = <span class="hl kwd">round</span>(sumreg$coefficients[2,1], digits = 3)
pval = <span class="hl kwd">round</span>(sumreg$coefficients[2,4], digits = 3)


comment1 &lt;- <span class="hl kwd">bquote</span>(Koeffizient == <span class="hl kwd">.</span>(slope))
comment2 &lt;- <span class="hl kwd">bquote</span>(R^2 == <span class="hl kwd">.</span>(r2))
comment3 &lt;- <span class="hl kwd">bquote</span>(p == <span class="hl kwd">.</span>(pval))

<span class="hl kwd">text</span>(-0,-10, comment1, cex = 1, col = col2)
<span class="hl kwd">text</span>(-0, -14, comment2, cex = 1, col = col2)
<span class="hl kwd">text</span>(-0, -18, comment3, cex = 1, col = col2)

<span class="hl kwd">dev.off</span>()
<span class="hl kwd">file.show</span>(<span class="hl str">&quot;myPlot.png&quot;</span>)
</pre></div>
</div></div>




</div> <!-- end of div scriptText -->


<div class='markEnd'> </div> <!-- A last horizontal ruler at the end of the document-->

</div> <!-- end of content div -->

</body>
</html>
